"use strict";(self.webpackChunktipoBooking=self.webpackChunktipoBooking||[]).push([[18],{628:(e,t,o)=>{o.r(t),o.d(t,{default:()=>a}),o(868);var n=o(329),i=o(466),s=o(225);const a={initCalendar:async function(e){const t=this;let i=document.querySelector("#tpb-booking-form")?document.querySelector("#tpb-booking-form").innerHTML:"";if(i||(i=n.Z.templates.widget),1==this.configs.products.length&&this.settings.general?.auto_continue_step&&"product"!=this.page.type){const e=this.configs.products[0].handle;let o=window.location.origin+"/products/"+e+".json";await fetch(o).then((e=>e.json())).then((e=>{t.product=e.product}))}const a=n.Z.render(i,{products:this.configs.products,tpbShopId:this.shop.id,isPaidPlan:parseFloat(this.shop.plan.price)>0||"BETA"===this.shop.plan.plan,settings:this.settings,tpbText:this.trans,isProductPage:!0,tpbProduct:t.product,tpbTimeZoneShop:this.timezone.shop});let l=!1;l=!(1!=this.configs.products.length||!this.settings.general?.auto_continue_step||"product"==this.page.type)||!e.classList.contains("page")&&!e.classList.contains("tpbOnlineBooking_form");const r=e.parentNode.querySelector(".tpb-booking-form");r&&(r.innerHTML="");const c=document.createElement("div");c.innerHTML=a,c.className=l?"tpb-booking-form product":"tpb-booking-form page",(0,s.BE)(e,c),document.body.className+=" booking-widget-appended";const d=c.querySelector(".continue-button.c1");l&&(2!=this.settings.general.hide_add_to_cart&&1!=this.settings.general.hide_add_to_cart||document.querySelectorAll('.tpb-atc-add_to_cart,.tpb-atc-wrapper,form[action*="cart"] [type="submit"]').forEach((e=>e.style.display="none")),2!=this.settings.general.hide_buy_now&&1!=this.settings.general.hide_buy_now||document.querySelectorAll(".tpb-atc-buy_now,.shopify-payment-button").forEach((e=>e.style.display="none")),2!=this.settings.general.hide_product_form&&1!=this.settings.general.hide_product_form||document.querySelectorAll('.tpb-product-form,form[action*="cart"]:not(.tpb-exclude)').forEach((e=>e.style.display="none")),this.hideDropdownService(this.settings.general,c),this.autoNextStep(this.settings.general,d),this.showFeaturedProductImages(this,c,l)),this.tooglePriceBooking(this.settings.general,c),this.handleOptionElement(c),d.addEventListener("click",(()=>{const e=this.getParameters(c),n=[Promise.all([o.e(788),o.e(326),o.e(321),o.e(267)]).then(o.bind(o,510)),this.getSlots(c,e)];Promise.all(n).then((e=>{const{default:o}=e[0];Object.assign(this,o),document.dispatchEvent(new CustomEvent("tipo:booking:loaded")),this.goToCalendar(c,e[1]),this.goToStep(c,2,t.settings.general)}))})),window.addEventListener("resize",(e=>{const t=c.offsetWidth,o=e.target.innerWidth;t<=599&&o>t?c.classList.add("x480"):c.classList.remove("x480")})),window.dispatchEvent(new Event("resize")),document.dispatchEvent(new CustomEvent("tipo:booking:loaded"))},handleOptionElement:function(e){const t=this,o=e.querySelector(".tpb-select-product"),n=e.querySelectorAll("select.tpb-select-option"),a=e.querySelector(".tpb-select-location"),l=e.querySelector(".tpb-select-employee"),r=e.querySelector(".bringToggle"),c=e.querySelector(".bringQty"),d=e.querySelector(".bringQty-input"),p=new i.Z({select:o});let u={variants:[],employee:null,location:null};const{multipleLocations:h,multipleEmployees:g}=this.settings.general,y=t=>{const o=e.querySelector('[name="productId"]').value,n=this.productApi[o],i=e.querySelectorAll("select.tpb-select-option"),a=e.querySelector(".tpb-message_not-available"),l=e.querySelector(".tpb-form-control.price"),c=l.querySelector(".tpb-text-price"),p=Array.from(i).reduce(((e,t)=>(t.value&&e.push(t.value),e)),[]);let u=n.variants.find((e=>e.options.toString()==p.toString()));1==n.variants.length&&"Default Title"==n.variants[0].options[0]&&(u=n.variants[0]),this.selectedVariant=u,u&&u.available?(u.price?(c.innerHTML=(0,s.lb)(u.price),l.style.display="block"):l.style.display="none",a.style.display="none"):(l.style.display="none",a.style.display="flex");const h=this.getAvailableCapacity(e),g=r&&(0,s.V$)(r,"tpb-form-control");g&&(g.style.display=0==h?"none":"block"),d&&d.dispatchEvent(new Event("change"));const y=this.configs.products.find((e=>e.id==o)).duration;this.updateDuration(e,y)},b=e=>{e.stopPropagation(),(0,s.V$)(e.target,"tpb-message_not-available").style.display="none"},m=(0,s.Ds)((async e=>{const t=(0,s.V$)(e.target,"tpb-box"),o=this.getParameters(t),{productId:n,locationId:i,employeeId:a,bringQty:l}=o,r=this.configs.products.find((e=>e.id==n));let c=n&&!0;if(c=c&&this.selectedVariant&&this.selectedVariant.available,"1"==this.settings.general.multipleEmployees&&"product"!==r.available_time_basis&&(c=c&&!isNaN(a)),"1"==this.settings.general.multipleLocations&&(c=c&&!isNaN(i)),l){const e=this.getAvailableCapacity(t);c=c&&l<=e}const d=t.querySelector(".step1 .continue-button");if(c?d.removeAttribute("disabled"):d.setAttribute("disabled","disabled"),2==this.getStep(t)&&(this.unsetSlots(t),c)){const e=await this.getSlots(t,o);this.goToCalendar(t,e)}return document.dispatchEvent(new CustomEvent("tipo:booking:options:update")),c}),150);if(o.addEventListener("change",(async o=>{u.location&&u.location.set(""),u.employee&&u.employee.set("");const n=this.configs.products.find((e=>e.id==o.target.value)),i="/products/"+n.handle+"?view=tipo_booking_raw_data_do_not_select";this.setLoading(e,!0);const s=await fetch(i).then((t=>(this.setLoading(e,!1),t.text())));new Function(s)(),this.productApi=this.productApi||{},this.productApi[o.target.value]=tpbProductApi,this.showFeaturedProductImages(t,e,!1,o.target.value),n.is_free&&e.closest(".tpbOnlineBooking_container")?e.closest(".tpbOnlineBooking_container").classList.add("isFree"):e.closest(".tpbOnlineBooking_container")&&e.closest(".tpbOnlineBooking_container").classList.remove("isFree"),this.buildOptionSelectors(e,tpbProductApi,u.variants),a.parentNode.style.display="none",l.parentNode.style.display="none","1"==g&&"product"!==n.available_time_basis?this.buildEmployeeSelector(n,u,l):"1"==h&&this.buildLocationSelector(n,null,u,a);const r=n.duration;this.updateDuration(e,r);const c=e.querySelector(".booking-note");c&&(c.innerHTML=n.note,c.style.display="block")})),n.forEach((e=>e.addEventListener("change",y))),l.addEventListener("change",(e=>{const t=this.configs.products.find((e=>e.id==o.value)),n=this.configs.employees.find((t=>t.id==e.target.value));n&&this.buildLocationSelector(t,n,u,a)})),r&&r.addEventListener("change",(e=>{c.style.display=e.target.checked?"block":"none",e.target.checked||(c.querySelector('[name="bring_qty"]').value="",c.querySelector('[name="bring_qty"]').removeAttribute("value"))})),d&&d.addEventListener("change",(e=>{const t=e.target.value,o=(0,s.V$)(e.target,"tpb-box"),n=this.getAvailableCapacity(o);o.querySelector("#bring_qty").setAttribute("max",n);const i=o.querySelector("#tpb-message-bring_qty");if(t>n){const e=this.trans.you_can_only_bring.replace("{number}",n);i.innerHTML=e}else i.innerHTML=""})),e.querySelectorAll("select,input").forEach((e=>{e.addEventListener("change",m)})),e.querySelectorAll(".dismiss").forEach((e=>{e.addEventListener("click",b)})),this.product){const t=o.querySelector('option[value="'+this.product.id+'"]'),n=e.classList.contains("product");t&&n&&(p.set(this.product.id),o.dispatchEvent(new Event("change")),p.disable())}},setLoading:function(e,t){const o=e.querySelector(".spinner");t?o.classList.add("loading"):o.classList.remove("loading")},updateDuration:function(e,t){const o=e.querySelector(".duration");if("product"==t.type&&(o.value=t.rule),"variant"==t.type&&this.selectedVariant){let e;e=t.option?t.rule.find((e=>this.selectedVariant.title.indexOf(e.value)>-1)):t.rule.find((e=>e.value==this.selectedVariant.id)),o.value=e&&e.duration}},getStep:function(e){return parseInt(e.querySelector(".content[data-step]").getAttribute("data-step"))},goToStep:function(e,t,o){const n=(0,s.V$)(e,"tpb-booking-form"),i=n.classList.contains("x480");e.querySelector(".content[data-step]").setAttribute("data-step",t),e.querySelector(".tpb-box-wrapper").setAttribute("data-step",t);const a=e.querySelector(".continue-button.c"+(t-1)),l=e.querySelector(`.continue-button.c${t}`),r=e.querySelector(`.back-button.c${t}`);r&&(r.style.display=i||3==t?"block":"none"),a&&(a.style.display="none"),l&&(l.style.display="block");const c=n.closest(".tpbOnlineBooking_container");c&&(3==t?c.classList.add("hideStep3"):c.classList.remove("hideStep3")),2==t&&this.showTimeSlot(o,e),document.dispatchEvent(new CustomEvent("tipo.booking.next.step",{detail:{form:n,step:t,button:l}}))},getParameters:function(e){const t=new Date,o=e.querySelector('[name="productId"]').value,n=e.querySelector('[name="employeeId"]').value,i=e.querySelector('[name="locationId"]').value,s=e.querySelector(".bringToggle")&&e.querySelector(".bringToggle").checked,a=e.querySelector('[name="bring_qty"]')&&e.querySelector('[name="bring_qty"]').value,l=t.getFullYear()+"-"+(parseInt(t.getMonth())+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes(),r={shop:this.shop.url,productId:o,variantId:this.selectedVariant&&this.selectedVariant.id,employeeId:n,locationId:i,customerIds:this.customer&&this.customer.id,currentDay:l};return s&&parseInt(a)&&(r.bringQty=parseInt(a)),r},getSlots:function(e,t){this.setLoading(e,!0);const o=new URLSearchParams(t);return fetch(`${this.appUrl}/booking_api/slots?${o.toString()}`).then((t=>(this.setLoading(e,!1),t.json())))},buildOptionSelectors:function(e,t,o){const n=t.options;if(n.length>0&&"Default Title"!==n[0].values[0]){if(this.buildSingleOptionSelector(e,n,o,1),n.length>1)if(this.buildSingleOptionSelector(e,n,o,2),n.length>2)this.buildSingleOptionSelector(e,n,o,3);else{const t=e.querySelector(".tpb-form-control-option.tpb-option-3"),o=t.querySelector("select.tpb-select-option-3");t.style.display="none",o.value="",o.dispatchEvent(new Event("change"))}else{const t=e.querySelector(".tpb-form-control-option.tpb-option-2"),o=t.querySelector("select.tpb-select-option-2");t.style.display="none",o.value="",o.dispatchEvent(new Event("change"))}e.querySelector(".tpb-form-control.variant").style.display="block"}else e.querySelector("select.tpb-select-option-1").dispatchEvent(new Event("change")),e.querySelector(".tpb-form-control.variant").style.display="none"},buildSingleOptionSelector:function(e,t,o,n){e.querySelector("label.tpb-label-option"+n).innerHTML=t[n-1].name,e.querySelector(".tpb-form-control-option.tpb-option-"+n).style.display="block";const s=t[n-1].values.map((e=>({text:e.replace(/"/g,"&quot;"),value:e}))),a=e.querySelector("select.tpb-select-option-"+n);o[n]&&o[n].destroy(),o[n]=new i.Z({select:a,data:s}),a.dispatchEvent(new Event("change"))},buildLocationSelector:function(e,t,o,n){let s=t&&this.configs.locations.filter((e=>t.location_ids.includes(e.id)));s||(s=e&&this.configs.locations.filter((t=>e.location_ids.includes(t.id)))),s=s.map((e=>({text:e.name,value:e.id}))),o.location&&(o.location.set(""),o.location.destroy()),o.location=new i.Z({select:n,placeholder:this.trans.location_placeholder,data:[{placeholder:!0,text:this.trans.location_placeholder,value:""},...s]}),1!=s.length&&!1!==this.settings.general.show_location_on_front_store||o.location.set(s[0].value),!1!==this.settings.general.show_location_on_front_store&&"1"==this.settings.general.multipleLocations&&(n.parentNode.style.display="block")},buildEmployeeSelector:function(e,t,o){let n=this.configs.employees.filter((t=>e.employee_ids.includes(t.id))).sort((function(e,t){return e.first_name<t.first_name?-1:e.first_name>t.first_name?1:0}));if(!n)return;const a=n.map((e=>({text:e.first_name+" "+e.last_name,id:e.id,value:e.id})));t.employee&&(t.employee.set(""),t.employee.destroy()),t.employee=new i.Z({select:o,data:[{placeholder:!0,text:this.trans.employee_placeholder,value:""},...a]}),1==a.length&&t.employee.set(a[0].value);const l=(0,s.V$)(o,"tpb-form");1==a.length&&this.settings.general.hide_employee_on_front_store?(o.parentNode.style.display="none",l&&l.classList.add("should_hide_employee_at_step3")):(o.parentNode.style.display="block",l&&l.classList.remove("should_hide_employee_at_step3")),o.dispatchEvent(new Event("change"))},getAvailableCapacity:function(e){const t=e.querySelector('[name="productId"]').value,o=this.configs.products.find((e=>e.id==t)),n=o&&o.capacity;let i=0;if(n&&("product"==n.type&&(i=parseInt(n.rule)-1),"variant"==n.type&&(i=parseInt(n.rule[this.selectedVariant&&this.selectedVariant.id])-1)),this.selectedVariant&&"shopify"==this.selectedVariant.inventory_management&&"deny"==this.selectedVariant.inventory_policy){const e=this.selectedVariant.inventory_quantity;e>1&&e-1<i&&(i=e-1),e<=1&&(i=0)}return i},autoNextStep:function(e,t){let o=e?.delay_nextStep?e.delay_nextStep:1500;if(e?.auto_continue_step&&t&&"none"!=t.getAttribute("display")){const e=setTimeout((async function(){await t.click(),clearTimeout(e)}),o)}},hideDropdownService:function(e,t){if(e?.hide_service_dropdown&&e?.hide_service_dropdown_name){switch(e.hide_service_dropdown_name[0]){case"0":t.classList.add("hideDropdown");break;case"1":t.classList.add("hideDropdown","hideServiceName");break;case"2":t.classList.add("hideDropdownIcon")}e?.hide_title?t.classList.add("hideTitle"):t.classList.remove("hideTitle")}else t.classList.remove("hideDropdown","hideServiceName","hideDropdownIcon","hideTitle")},tooglePriceBooking:function(e,t){e?.hide_price_booking?t.classList.add("hidePrice"):t.classList.remove("hidePrice")},showFeaturedProductImages:function(e,t,o,n){if(e.settings.general?.show_featured_product_image&&t){let i=o?e.product.featured_image:e.productApi[n].featured_image;i&&!t.closest("#tpbOnlineBooking")&&Object.assign(t.querySelector(".step1").style,{backgroundImage:`url(${i})`,backgroundSize:"100% 100%"})}},showTimeSlot:function(e,t){if(e?.show_time_slot&&""==t.querySelector(".tpb-timepicker").innerHTML){const e=t.querySelector('[data-view="day picked"]');e&&e.click()}}}}}]);